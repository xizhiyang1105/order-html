<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/js/bootstrap3/css/bootstrap.css" rel="stylesheet">
    <link href="/js/bootstrap3/css/bootstrap-theme.css" rel="stylesheet">
    <link href="/js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <link rel="stylesheet" href="/js/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.css">
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/js/bootstrap3/js/bootstrap.js"></script>
    <script src="/js/DataTables/DataTables-1.10.18/js/jquery.dataTables.js"></script>
    <script src="/js/DataTables/DataTables-1.10.18/js/dataTables.bootstrap.js"></script>
    <script src="/js/bootstrap-datetimepicker/js/moment-with-locales.js"></script>
    <script src="/js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/bootbox/bootbox.min.js"></script>
    <script src="/js/fileinput5/js/fileinput.js"></script>
    <script src="/js/fileinput5/js/locales/zh.js"></script>
    <link rel="stylesheet" href="/js/fileinput5/css/fileinput.css">
    <link rel="stylesheet" href="/js/bootstrap-validator/css/bootstrapValidator.min.css">
    <script src="/js/bootstrap-validator/js/bootstrapValidator.min.js"></script>
    <script src="/js/bootstrap-validator/js/language/zh_CN.js"></script>
</head>
<script type="text/html" id="addDrug"
        9>
    <div>
        <form class="form-horizontal" id="formApp" >

            <div class="form-group">
                <label  class="col-sm-2 control-label">å•†å“åç§°</label>
                <div class="col-sm-4" id="xizh">
                </div>
            </div>


            <div class="form-group">
                <label  class="col-sm-2 control-label">è´­ä¹°æ•°é‡</label>
                <div class="col-sm-4">
                    <input class="form-control" id="add_shu" onblur="gaishu()" ></input>
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">å•†å“ä»·é’±</label>
                <div class="col-sm-4">
                    <input class="form-control" id="add_price" readonly></input>
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">å°è®¡é‡‘é¢</label>
                <div class="col-sm-4">
                    <input class="form-control" id="add_xiaoji" readonly></input>
                </div>
            </div>
        </form>

    </div>

</script>
<script type="text/html" id="updateDrug"
        9>
    <div>
        <form class="form-horizontal" id="formApp1" >
            <div class="form-group">
                <label  class="col-sm-2 control-label">å•†å“åç§°</label>
                <div class="col-sm-4" id="up_brand">

                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">å•†å“ä»·é’±</label>
                <div class="col-sm-4">
                    <input class="form-control" id="up_price" readonly></input>
                </div>
            </div>


            <div class="form-group">
                <label  class="col-sm-2 control-label">è´­ä¹°æ•°é‡</label>
                <div class="col-sm-4">
                    <input class="form-control" id="up_shu" onblur="gaishu2()"></input>
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">å°è®¡é‡‘é¢</label>
                <div class="col-sm-4">
                    <input class="form-control" id="up_xiaoji" readonly></input>
                </div>
            </div>

        </form>

    </div>

</script>
<script type="text/javascript">
    $(function () {
        initDataTable();
        initAddBrandList1();
    });
    function initDataTable(){
        $('#example').DataTable({
            "destroy": true,//retrieve: trueè¡¨ç¤ºæˆ‘å·²ç»çŸ¥é“åˆå§‹åŒ–é€‰é¡¹ä¸èƒ½åœ¨åˆå§‹åŒ–ä¹‹åæ›´æ”¹ï¼Œåªæ˜¯å¸Œæœ›è¿”å›DataTableå®ä¾‹ã€‚
            "pagingType":"simple_numbers",
            "lengthMenu": [[ 4, 6,9], [4, 6,9]],
            "serverSide": true,
            "ordering": false, // ç¦æ­¢æ’åº
            "searching": false,//å¯ç”¨æœç´¢åŠŸèƒ½
            "ajax": {
                url: 'http://localhost:8088/order/queryOrderList.action',
                type: 'POST',
                "data":function (d) {
                    d.minPrice=$("#minPrice").val();
                    d.maxPrice=$("#maxPrice").val();
                    d.brandId=$("#q_proId").val();
                },
                "dataSrc":function (f) {
                    if(f.status==200){
                        f.draw =f.data.draw;
                        f.recordsTotal=f.data.recordsTotal;
                        f.recordsFiltered=f.data.recordsFiltered;
                        return f.data.data;
                    }else{
                        return "";
                    }
                },
            },
            "columns": [
                {"data": "id"},
                {"data": "proName"},
                {"data": "price"},
                {"data": "shu"},
                {"data": "xiaoji"},
                {"data":"id",render:function(data,type,row,meta){
                        var b="";
                        b+= ' <div class="btn-group" role="group" aria-label="...">'+
                            '<button type="button" class="btn btn-info" onclick="toUpdate('+data+')"><i class="glyphicon glyphicon-wrench"></i>ä¿®æ”¹</button>'+
                            '<button type="button" class="btn btn-danger" onclick="del('+data+')"><i class="glyphicon glyphicon-remove"></i>åˆ é™¤</button>'+
                            '</div>';
                        return b;
                    }}
            ],
            language: {
                "sProcessing": "å¤„ç†ä¸­...",
                "sLengthMenu": "æ˜¾ç¤º _MENU_ é¡¹ç»“æœ",
                "sZeroRecords": "æ²¡æœ‰åŒ¹é…ç»“æœ",
                "sInfo": "æ˜¾ç¤ºç¬¬ _START_ è‡³ _END_ é¡¹ç»“æœï¼Œå…± _TOTAL_ é¡¹",
                "sInfoEmpty": "æ˜¾ç¤ºç¬¬ 0 è‡³ 0 é¡¹ç»“æœï¼Œå…± 0 é¡¹",
                "sInfoFiltered": "(ç”± _MAX_ é¡¹ç»“æœè¿‡æ»¤)",
                "sInfoPostFix": "",
                "sSearch": "æœç´¢:",
                "sUrl": "",
                "sEmptyTable": "è¡¨ä¸­æ•°æ®ä¸ºç©º",
                "sLoadingRecords": "è½½å…¥ä¸­...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "é¦–é¡µ",
                    "sPrevious": "ä¸Šé¡µ",
                    "sNext": "ä¸‹é¡µ",
                    "sLast": "æœ«é¡µ"
                },
                "oAria": {
                    "sSortAscending": ": ä»¥å‡åºæ’åˆ—æ­¤åˆ—",
                    "sSortDescending": ": ä»¥é™åºæ’åˆ—æ­¤åˆ—"
                }
            }
        });
    }
    function toUpdate(id) {
        window.event.stopPropagation();// é˜»æ­¢å†’æ³¡
        bootbox.dialog({
            message: $("#updateDrug").html(),
            title: "ä¿®æ”¹",
            size: "large",
            buttons: {
                Cancel: {
                    label: "å–æ¶ˆ",
                    className: "btn-default",
                    callback: function () {
                    }
                }
                , OK: {
                    label: "ç¡®è®¤",
                    className: "btn-danger",
                    callback: function () {
                        var param = {};
                        param.proID= $("#up1_brand").val();
                        param.price=$("#up_price").val();
                        param.shu=$("#up_shu").val();
                        param.xiaoji=$("#up_xiaoji").val();
                        param.del=0;
                        param.id = id;
                        $.post(
                            "http://localhost:8088/order/updateOrder.action",
                            param,
                            function (data) {
                                if (data.status == 200) {
                                    queryList();
                                } else {
                                    bootbox.alert("æ“ä½œå¤±è´¥ï¼,è¯·è”ç³»ç®¡ç†å‘˜", function () {

                                    })
                                }

                            }
                        )
                    }
                }
            }
        });
        //åˆå§‹åŒ–å“ç‰Œ
        upBrandList();
        $.post(
            "http://localhost:8088/order/queryOrderById.action",
            {"id":id},
            function (result) {
                if(result.status==200){
                    var datas=result.data;
                    $("#up1_brand").val(datas.proID);
                    $("#up_price").val(datas.price);
                    $("#up_shu").val(datas.shu);
                    $("#up_xiaoji").val(datas.xiaoji);
                }
            }
        )
    }

    function queryList(){
        $("#example").dataTable().fnDraw(false);//ç‚¹å‡»äº‹ä»¶è§¦å‘tableé‡æ–°è¯·æ±‚æœåŠ¡å™¨
    }
    function initAddBrandList1() {
        $.ajaxSettings.async = false;
        $.post(
            "http://localhost:8088/order/queryProduct.action",
            function (result) {
                if(result.status==200){
                    var data=result.data;
                    for (var i = 0; i < data.length; i++) {
                        $("#q_proId").append(
                            "<option value='"+data[i].id+"'>"+data[i].proName+"</option>"
                        );
                    }
                }
            }
        )
    }
    //æ–°å¢å“ç‰Œç±»å‹
    function initAddBrandList() {
        $.ajaxSettings.async = false;
        $.post(
            "http://localhost:8088/order/queryProduct.action",
            function (result) {
                if(result.status==200){
                    var data=result.data;
                    var str='';
                    str+=' <select class="form-control"  id="add_brand" onchange="gai1(this.value)">\n' +
                        '                        <option value="-1">==è¯·é€‰æ‹©==</option>'
                    for (var i = 0; i < data.length; i++) {
                           str+= "<option value='"+data[i].id+"'>"+data[i].proName+"</option>"
                    }
                    str+='</select>';
                }
                $("#xizh").append(str)
            }
        )
    }
    function gaishu() {
        var shu = $("#add_shu").val();
        var price = $("#add_price").val();
        var xiaoji=shu*price;
        $("#add_xiaoji").val(xiaoji);
    }
    function gaishu2() {
        var shu = $("#up_shu").val();
        var price = $("#up_price").val();
        var xiaoji=shu*price;
        $("#up_xiaoji").val(xiaoji);
    }
    function gai1(id) {
        $.post(
            "http://localhost:8088/order/queryprice.action",
            {"id":id},
            function (da) {
                var data=da.data;
                $("#add_price").val(data.price);
            }
        )
    }
    function gai2(id) {
        $("#up_shu").val("");
        $("#up_xiaoji").val("");
        $.post(
            "http://localhost:8088/order/queryprice.action",
            {"id":id},
            function (da) {
                var data=da.data;
                $("#up_price").val(data.price);
            }
        )
    }
    //ä¿®æ”¹å“ç‰Œç±»å‹
    function upBrandList() {
        $.ajaxSettings.async = false;
        $.post(
            "http://localhost:8088/order/queryProduct.action",
            function (result) {
                if(result.status==200){
                    var data=result.data;
                    var str='';
                    str+=' <select class="form-control"  id="up1_brand" onchange="gai2(this.value)">\n' +
                        '                        <option value="-1">==è¯·é€‰æ‹©==</option>'
                    for (var i = 0; i < data.length; i++) {
                        str+= "<option value='"+data[i].id+"'>"+data[i].proName+"</option>"
                    }
                    str+='</select>';
                }
                $("#up_brand").append(str)
            }
        )
    }
    //åˆ é™¤
    function del(id) {
        var a=1;
        window.event.stopPropagation();// é˜»æ­¢å†’æ³¡
        bootbox.dialog({
            // dialogçš„å†…å®¹
            message: "ç¡®å®šè¦åˆ é™¤è¯¥æ•°æ®å—ï¼Ÿï¼Ÿï¼Ÿ",

            // dialogçš„æ ‡é¢˜
            title: "ç³»ç»Ÿæ¸©é¦¨æç¤ºğŸ˜Šï¼š",

            // é€€å‡ºdialogæ—¶çš„å›è°ƒå‡½æ•°ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä½¿ç”¨ESCé”®åŠç‚¹å‡»å…³é—­
            onEscape: function() {},

            // æ˜¯å¦æ˜¾ç¤ºæ­¤dialogï¼Œé»˜è®¤true
            show: true,

            // æ˜¯å¦æ˜¾ç¤ºbodyçš„é®ç½©ï¼Œé»˜è®¤true
            backdrop: true,

            // æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®ï¼Œé»˜è®¤true
            closeButton: true,

            // æ˜¯å¦åŠ¨ç”»å¼¹å‡ºdialogï¼ŒIE10ä»¥ä¸‹ç‰ˆæœ¬ä¸æ”¯æŒ
            animate: true,

            // dialogçš„ç±»å
            className: "my-modal",

            // dialogåº•ç«¯æŒ‰é’®é…ç½®
            buttons: {

                // å…¶ä¸­ä¸€ä¸ªæŒ‰é’®é…ç½®
                success: {
                    // æŒ‰é’®æ˜¾ç¤ºçš„åç§°
                    label: "ç¡®å®š!",

                    // æŒ‰é’®çš„ç±»å
                    className: "btn-success",

                    // ç‚¹å‡»æŒ‰é’®æ—¶çš„å›è°ƒå‡½æ•°
                    callback: function() {
                        $.post(
                            "http://localhost:8088/order/delOrderId.action",
                            {"id":id,"del":a},
                            function (data) {
                                if(data.status==200){
                                    queryList();
                                }else {
                                    bootbox.confirm({
                                        size: "small",
                                        message: "åˆ é™¤å¤±è´¥",
                                        callback: function(result){ /* result is a boolean; true = OK, false = Cancel*/ }
                                    });
                                }

                            }
                        )
                    }
                },

                // å¦ä¸€ä¸ªæŒ‰é’®é…ç½®
                "Danger!": {
                    className: "btn-danger",
                    label: "å–æ¶ˆ",
                    callback: function() {}
                }
            }
        });
    }
    //å¢åŠ 
    function addDrug(){
        bootbox.dialog({
            message: $("#addDrug").html(),
            title: "æ·»åŠ ",
            size:"large",
            buttons: {
                Cancel: {
                    label: "å–æ¶ˆ",
                    className: "btn-default",
                    callback: function () {
                    }
                }
                , OK: {
                    label: "ç¡®è®¤",
                    className: "btn-danger",
                    callback: function () {
                        var param={};
                        param.proID=$("#add_brand").val();
                        param.price=$("#add_price").val();
                        param.shu=$("#add_shu").val();
                        param.xiaoji=$("#add_xiaoji").val();
                        param.del=0
                        $.post(
                            "http://localhost:8088/order/addOrder.action",
                            param,
                            function (data) {
                                if(data.status==200){
                                    queryList();
                                }else{
                                    bootbox.alert("æ“ä½œå¤±è´¥ï¼,è¯·è”ç³»ç®¡ç†å‘˜",function(){

                                    })
                                }

                            }
                        )
                    }
                }
            }
        });
        initAddBrandList();
    }
</script>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">

            <form class="form-horizontal" id="aaa">
                <div class="form-group">


                    <label class="col-sm-2 control-label">å•†å“ä»·æ ¼</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input type="text" class="form-control" id="minPrice" name="minPrice" aria-describedby="basic-addon1">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-resize-horizontal"></i></span>
                            <input type="text" class="form-control" id="maxPrice" name="maxPrice" aria-describedby="basic-addon1">
                        </div>
                    </div>

                    <label class="col-sm-2 control-label">å•†å“åç§°</label>
                    <div class="col-sm-2">
                        <select class="form-control" id="q_proId">
                            <option value="-1">==è¯·é€‰æ‹©==</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-5 col-sm-10">
                            <div class="btn-group btn-group-lg" role="group" aria-label="...">
                                <button type="button" class="btn btn-primary" onclick="queryList()">æäº¤</button>
                                <button type="reset" class="btn btn-danger">é‡ç½®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <button type="button" class="btn btn-info btn-lg glyphicon" onclick="addDrug()" >æ–°å¢è®¢å•</button>
                </div>
                <div class="panel-body">
                    <div class="bs-example" data-example-id="bordered-table">
                        <table class="table table-striped table-bordered" id="example" style="width:100%">
                            <thead>
                            <tr>
                                <td>è®¢å•å·</td>
                                <td>å•†å“åç§°</td>
                                <td>å•†å“ä»·æ ¼</td>
                                <td>è´­ä¹°æ•°é‡</td>
                                <td>å°è®¡</td>
                                <td>æ“ä½œ</td>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>